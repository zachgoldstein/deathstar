<!DOCTYPE html>
<html>
<head>
    <title>Testman Results</title>
    <link rel="stylesheet" type="text/css" href="./lib/static/assets/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="./lib/static/assets/css/keen-dashboards.css" />
</head>
<body class="application">

<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="https://github.com/zachgoldstein/testscaleman">
                <span class="glyphicon glyphicon-fire"></span>
            </a>
            <a class="navbar-brand" href="https://github.com/zachgoldstein/testscaleman">Testman</a>
        </div>
        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-left">
                <li><a href="https://github.com/zachgoldstein/testscaleman">Source</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="https://github.com/zachgoldstein/testscaleman">Started test at: {{.Latest.StartTime}}</a></li>
            </ul>
        </div>
    </div>
</div>

<div class="container-fluid">

<div class="row">
    <div class="col-sm-12 col-md-12">
        <div class="chart-wrapper">
            <div class="chart-title">
                Load Test Progress
            </div>
            <div class="chart-stage">
                <div class="progress">
                    <div class="progress-bar progress-bar-info progress-bar-striped active" role="progressbar" aria-valuenow="{{.ProgressBarCurrent}}" aria-valuemin="0" aria-valuemax="{{.ProgressBarMax}}" style="width: {{.PercentageComplete}}%;">
                        <span style="color: black;">{{.PercentageComplete}}%</span>
                    </div>
                </div>
            </div>
            <div class="chart-notes">
                <p>Time Elapsed: {{.Latest.TimeElapsed}}
                    <span class="pull-right">Test Length: {{.Latest.TotalTestDuration}}</span>
                </p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-sm-6 col-md-3">
        <div class="chart-wrapper">
            <div class="chart-title">
                Mode
            </div>
            <div class="chart-stage">
                <h3>{{.ModeDesc}}</h3>
            </div>
        </div>
    </div>
    <div class="col-sm-6 col-md-3">
        <div class="chart-wrapper">
            <div class="chart-title">
                CPUs
            </div>
            <div class="chart-stage">
                <h1>{{.ReqOpts.CPUs}} CPUs</h1>
            </div>
        </div>
    </div>
    <div class="col-sm-6 col-md-3">
        <div class="chart-wrapper">
            <div class="chart-title">
                Concurrency
            </div>
            <div class="chart-stage">
                <h3>{{.ReqOpts.Concurrency}} workers in pool</h3>
            </div>
        </div>
    </div>
    <div class="col-sm-6 col-md-3">
        <div class="chart-wrapper">
            <div class="chart-title">
                Specified Rate
            </div>
            <div class="chart-stage">
                <h1>{{.ReqOpts.Rate}}req/s</h1>
            </div>
        </div>
    </div>

</div>

<div class="row">
    <div class="col-sm-6 col-md-6">
        <div class="chart-wrapper">
            <div class="chart-title">
                Harvest
            </div>
            <div class="chart-stage">
                <h1>{{.Harvest}}%</h1>
            </div>
            <div class="chart-notes">
                Percentage of requests with 200 responses
            </div>
        </div>
    </div>
    <div class="col-sm-6 col-md-6">
        <div class="chart-wrapper">
            <div class="chart-title">
                Yield
            </div>
            <div class="chart-stage">
                <h1>{{.Yield}}%</h1>
            </div>
            <div class="chart-notes">
                Percentage of responses that validate against schema
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-sm-4 col-md-4">
        <div class="chart-wrapper">
            <div class="chart-title">
                Total Requests Issued
            </div>
            <div class="chart-stage text-center">
                <h1>{{.Latest.TotalRequests}}</h1>
            </div>
        </div>
    </div>
    <div class="col-sm-4 col-md-4">
        <div class="chart-wrapper">
            <div class="chart-title">
                Total Responses Received
            </div>
            <div class="chart-stage text-center">
                <h1>{{.Latest.TotalResponses}}</h1>
            </div>
        </div>
    </div>
    <div class="col-sm-4 col-md-4">
        <div class="chart-wrapper">
            <div class="chart-title">
                Valid Responses
            </div>
            <div class="chart-stage text-center">
                <h1>{{.Latest.TotalValidResponses}}</h1>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-sm-4 col-md-2">
        <div class="chart-wrapper">
            <div class="chart-title">
                Req Rate
            </div>
            <div class="chart-stage text-center">
                <h2>{{.Latest.Rate}}req/sec</h2>
            </div>
        </div>
    </div>
    <div class="col-sm-4 col-md-2">
        <div class="chart-wrapper">
            <div class="chart-title">
                Current Throughput (kb/s)
            </div>
            <div class="chart-stage text-center">
                <h2>{{.ThroughputKbs}}kb/sec</h2>
            </div>
        </div>
    </div>
    <div class="col-sm-4 col-md-2">
        <div class="chart-wrapper">
            <div class="chart-title">
                Current Throughput (resp/s)
            </div>
            <div class="chart-stage text-center">
                <h2>{{.Latest.LatestRespThroughput}} resp/s</h2>
            </div>
        </div>
    </div>
    <div class="col-sm-6 col-md-3">
        <div class="chart-wrapper">
            <div class="chart-title">
                Mean Throughput (resp/s)
            </div>
            <div class="chart-stage text-center">
                <h2>{{.AvgThroughputResps}} resp/s</h2>
            </div>
        </div>
    </div>
    <div class="col-sm-6 col-md-3">
        <div class="chart-wrapper">
            <div class="chart-title">
                Mean Throughput (kb/s)
            </div>
            <div class="chart-stage text-center">
                <h2>{{.AvgThroughputKbs}}kb/sec</h2>
            </div>
        </div>
    </div>

 </div>

<div class="row">

    <div class="col-sm-6 col-md-6">
        <div class="chart-wrapper">
            <div class="chart-title">
                Throughput Over Time (resp/s)
            </div>
            <div class="chart-stage">
                <div id="throughputRespTime"></div>
            </div>
        </div>
    </div>

    <div class="col-sm-6 col-md-6">
        <div class="chart-wrapper">
            <div class="chart-title">
                Throughput Over Time (kb/s)
            </div>
            <div class="chart-stage">
                <div id="throughputBytesTime"></div>
            </div>
        </div>
    </div>
</div>


<div class="row">
    <div class="col-sm-4 col-md-3">
        <div class="chart-wrapper">
            <div class="chart-title">
                Maximum Response Time
            </div>
            <div class="chart-stage text-center">
                <h1>{{.MaxResponseTime}}s</h1>
            </div>
        </div>
    </div>
    <div class="col-sm-4 col-md-3">
        <div class="chart-wrapper">
            <div class="chart-title">
                Average Response Time
            </div>
            <div class="chart-stage text-center">
                <h1>{{.AvgResponseTime}}s</h1>
            </div>
        </div>
    </div>
    <div class="col-sm-4 col-md-3">
        <div class="chart-wrapper">
            <div class="chart-title">
                {{.TopPercentileTimeTitle}} Response Time
            </div>
            <div class="chart-stage text-center">
                <h1>{{.TopPercentileTime}}s</h1>
            </div>
        </div>
    </div>
    <div class="col-sm-4 col-md-3">
        <div class="chart-wrapper">
            <div class="chart-title">
                Minimum Response Time
            </div>
            <div class="chart-stage text-center">
                <h1>{{.MinResponseTime}}s</h1>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-sm-6 col-md-3">
        <div class="chart-wrapper">
            <div class="chart-title">
                Total Latency Percentiles
            </div>
            <div class="chart-stage">
                <div id="totalResponseCht"></div>
            </div>
            <div class="chart-notes">
                (Latencies in seconds)
            </div>
        </div>
    </div>
    <div class="col-sm-6 col-md-3">
        <div class="chart-wrapper">
            <div class="chart-title">
                Connection Latency Percentiles
            </div>
            <div class="chart-stage">
                <div id="connectCht"></div>
            </div>
            <div class="chart-notes">
                (Latencies in seconds)
            </div>
        </div>
    </div>
    <div class="col-sm-6 col-md-3">
        <div class="chart-wrapper">
            <div class="chart-title">
                Total Latency Histogram
            </div>
            <div class="chart-stage">
                <div id="totalHist"></div>
            </div>
            <div class="chart-notes">
                (Latencies in seconds)
            </div>
        </div>
    </div>
    <div class="col-sm-6 col-md-3">
        <div class="chart-wrapper">
            <div class="chart-title">
                Connection Latency Histogram
            </div>
            <div class="chart-stage">
                <div id="connHist"></div>
            </div>
            <div class="chart-notes">
                (Latencies in seconds)
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-sm-4 col-md-4">
        <div class="chart-wrapper">
            <div class="chart-title">
                Failures
            </div>
            <div class="chart-stage text-center">
                <h1>{{.Latest.Failures}}</h1>
            </div>
        </div>
    </div>
    <div class="col-sm-4 col-md-4">
        <div class="chart-wrapper">
            <div class="chart-title">
                Non-200 Status Code Failures
            </div>
            <div class="chart-stage text-center">
                <h1>{{.Latest.RespFailures}}</h1>
            </div>
        </div>
    </div>
    <div class="col-sm-4 col-md-4">
        <div class="chart-wrapper">
            <div class="chart-title">
                Response Validation Failures
            </div>
            <div class="chart-stage text-center">
                <h1>{{.Latest.ValidationFailures}}</h1>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-sm-12 col-md-12">
        <div class="chart-wrapper">
            <div class="chart-title">
                Failures
            </div>
            <div class="chart-stage">
                <table class="table table-bordered">
                    <thead>
                    <tr>
                        <th># Failures</th>
                        <th>Failure Type</th>
                    </tr>
                    </thead>
                    <tbody>
                    {{range $error, $count := .Latest.FailureCounts}}
                    <tr>
                        <td>{{$count}}</td>
                        <td>{{$error}}</td>
                    </tr>
                    {{end}}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<hr>

<p class="small text-muted">Built with &#9829; by Zach Goldstein using <a href="https://keen.io">Keen IO</a></p>

</div>

<script type="text/javascript" src="./lib/static/assets/lib/jquery/dist/jquery.min.js"></script>
<script type="text/javascript" src="./lib/static/assets/lib/bootstrap/dist/js/bootstrap.min.js"></script>

<script type="text/javascript" src="./lib/static/assets/lib/holderjs/holder.js"></script>
<script>
    Holder.add_theme("white", { background:"#fff", foreground:"#a7a7a7", size:10 });
  </script>

<script type="text/javascript" src="./lib/static/assets/lib/keen-js/dist/keen.min.js"></script>
<script type="text/javascript" src="./lib/static/assets/js/meta.js"></script>

<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script>
    google.load('visualization', '1', {packages: ['corechart']});
    google.setOnLoadCallback(drawCharts);

    function drawCharts() {
      percentiles = [
        {{range .Latest.Percentiles}}
            {{.}},
        {{end}}
      ]
      var options = {
        hAxis: {
          title: 'Percentiles'
        },
        vAxis: {
          title: 'Latency(s)'
        },
        legend: {position: 'none'},
      };

      var totalPercentiles = new google.visualization.DataTable();
      totalPercentiles.addColumn('string', 'Total Percentiles');
      totalPercentiles.addColumn('number', 'Latency (s)');

      totalPercentiles.addRows([
        {{range $index, $total := .LatestTotalPercentiles}}
            [ percentiles[ {{$index}} ] * 100 + "" ,{{$total}}],
        {{end}}
      ]);

      var chart = new google.visualization.LineChart( document.getElementById('totalResponseCht') );
      chart.draw(totalPercentiles, options);

      var connectionPercentiles = new google.visualization.DataTable();
      connectionPercentiles.addColumn('string', 'Total Percentiles');
      connectionPercentiles.addColumn('number', 'Latency (s)');

      connectionPercentiles.addRows([
        {{range $index, $total := .LatestConnectPercentiles}}
            [ percentiles[ {{$index}} ] * 100 + "" ,{{$total}}],
        {{end}}
      ]);

      var chart = new google.visualization.LineChart( document.getElementById('connectCht') );
      chart.draw(connectionPercentiles, options);


      var options = {
        hAxis: {
          title: 'Latency(s)'
        },
        vAxis: {
          title: 'Count'
        },
        legend: {position: 'none'},
      };

      var data = google.visualization.arrayToDataTable(
        [
            ['Latencies'],
            {{range $index, $total := .TotalHistogramTimes}} [{{$total}}], {{end}}
        ]
      );

        var chart = new google.visualization.Histogram(document.getElementById('totalHist'));
        chart.draw(data, options);

      var options = {
        hAxis: {
          title: 'Latency(s)'
        },
        vAxis: {
          title: 'Count'
        },
        chartArea: {
           height: '40%'
        },
        legend: {position: 'none'},
      };

      var data = google.visualization.arrayToDataTable(
        [
            ['Latencies'],
            {{range $index, $total := .ConnectionHistogramTimes}}
                [{{$total}}],
            {{end}}
        ]
      );

        var chart = new google.visualization.Histogram(document.getElementById('connHist'));
        chart.draw(data, options);


      var throughputResp = new google.visualization.DataTable();
      throughputResp.addColumn('string', 'Time');
      throughputResp.addColumn('number', 'Resp/s');

      throughputResp.addRows([
        {{range $index, $resps := .Latest.RespThroughputs}} [ "{{$index}}s",{{$resps}}], {{end}}
      ]);

      var options = {
        hAxis: {
          textPosition: 'none',
            gridlines: {
                color: 'transparent'
            },
        },
        vAxis: {
            baselineColor: 'transparent',
            gridlines: {
                color: 'transparent'
            },
        },
        height: 100,
        legend: {position: 'none'},
      }

      var chart = new google.visualization.LineChart( document.getElementById('throughputRespTime') );
      chart.draw(throughputResp, options);

      var throughputBytes = new google.visualization.DataTable();
      throughputBytes.addColumn('string', 'Time');
      throughputBytes.addColumn('number', 'kb/s');

      throughputBytes.addRows([
        {{range $index, $bytes := .Latest.ByteThroughputs}} [ "{{$index}}s",{{$bytes}}/1000], {{end}}
      ]);

      var options = {
        hAxis: {
          textPosition: 'none',
            gridlines: {
                color: 'transparent'
            },
        },
        vAxis: {
            baselineColor: 'transparent',
            gridlines: {
                color: 'transparent'
            },
        },
        height: 100,
        legend: {position: 'none'},
      }

      var chart = new google.visualization.LineChart( document.getElementById('throughputBytesTime') );
      chart.draw(throughputBytes, options);

    }
</script>

</body>
</html>